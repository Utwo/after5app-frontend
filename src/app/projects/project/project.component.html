<div *ngIf="project">
  <div class="jumbotron-fluid">
    <div class="container">
      <h2>{{project.title}}</h2>
      by <a routerLink="/profile/{{project.user_id}}">{{project.user.name}}</a> &sdot;
      <i class="text-muted project__date"> {{ project.created_at | timeAgo}} </i>
    </div>
  </div>
  <article class="container m-y-3">
    <div class="row">
      <section class="col-lg-8 col-md-7">
        <div class="m-b-3">
          <h3 class="title-border title-border--green p-b-1">Project description</h3>
          <p>{{project.description}}</p>
        </div>
        <div *ngIf="project.position.length > 0">
          <h3 class="title-border title-border--green p-b-1">I need help with</h3>
          <dl *ngFor="let position of project.position">
            <dt class="btn btn-sm btn-gradient-primary">
              <strong>{{position.skill.name}}</strong>
            </dt>
            <dd [class.text-muted]="!position.status">{{position.description}}</dd>
          </dl>
        </div>
      </section>

      <section class="col-lg-4 col-md-5">
        <div class="sidebar p-a-1">
          <div *ngIf="!myProject && state.isLoggedIn()" class="m-b-1">
            <button (click)="applyModal.show()" class="btn btn-primary m-r-1">
              <svg class="icon">
                <use xlink:href="assets/icons.svg#icon-rocket-color"></use>
              </svg>
            </button>
            <span>Help this project become reality!</span>
          </div>
          <hr *ngIf="!myProject && state.isLoggedIn()">
          <div>
            <button *ngIf="!myProject && state.isLoggedIn()" #favorite (click)="addFavorite()"
                    class="btn m-r-1 btn-circle" [class.btn-danger]="isFavorite"
                    [class.btn-primary]="!isFavorite">
              <svg *ngIf="isFavorite" class="icon">
                <use xlink:href="assets/icons.svg#icon-heart"></use>
              </svg>
              <svg *ngIf="!isFavorite" class="icon text-info">
                <use xlink:href="assets/icons.svg#icon-heart-o"></use>
              </svg>
            </button>
            <span #favoriteSpan title="Login to favorite a project"><svg *ngIf="!state.isLoggedIn() || myProject"
                                                                         class="icon text-primary icon-lg m-r-1">
                <use xlink:href="assets/icons.svg#icon-heart"></use>
              </svg> {{project.favorite_count}} favorites</span>
          </div>
        </div>
        <div *ngIf="myProject" class="text-xs-center m-t-2">
          <button class="btn btn-primary" (click)="editModal.show()">
            <svg class="icon">
              <use xlink:href="assets/icons.svg#icon-pencil"></use>
            </svg>
            <span class="hidden-sm-down">Edit project</span>
          </button>

          <button class="btn btn-danger" (click)="deleteModal.show()">
            <svg class="icon">
              <use xlink:href="assets/icons.svg#icon-bin"></use>
            </svg>
            <span class="hidden-sm-down">Delete project</span>
          </button>
          <hr>
        </div>

        <div *ngIf="members && members.length > 0">
          <h3 class="title-border title-border--green p-b-1 m-t-2">Members</h3>
          <ul class="list-unstyled">
            <li *ngFor="let member of members; let i = index" class="panel m-b-1">
              <a routerLink="/profile/{{member.id}}"><img class="profile-img m-r-1"
                                                          src="{{member.picture+'?s=30&width=30&height=30'}}">{{member.name}}</a>
              <button class="btn btn-sm btn-outline-danger m-l-1" title="remove member" *ngIf="myProject"
                      (click)="removeMember(i)">&times;</button>
            </li>
          </ul>
        </div>
      </section>
    </div>

  </article>

  <div class="container m-y-3">
    <div class="row">
      <tabset class="col-md-8">
        <tab [heading]="Comments" [active]="true">
          <template tabHeading>
            Comments
          </template>
          <app-comments [project_id]="project.id" [comments]="project.comment"
                        class="row comment panel--left"></app-comments>
        </tab>
        <tab *ngIf="isMember || myProject" [heading]="Messages">
          <template tabHeading>
            <span title="only visible to project members">Messages</span>
          </template>
          <app-messages [project_id]="project.id" [owner_id]="project.user_id"
                        class="row comment panel--left"></app-messages>
        </tab>
        <tab *ngIf="myProject && applications" [heading]="Applications">
          <template tabHeading>
            <span>Applications
              <strong *ngIf="applications && applications.length > 0" class="btn btn-primary btn-sm btn-circle-sm">{{applications.length}}</strong>
            </span>
          </template>
          <app-user-applications [project]="project" [user_applications]="applications"
                                 (onAccept)="getMembers()"></app-user-applications>
        </tab>
      </tabset>
    </div>
  </div>

  <aside *ngIf="related && related.length > 0" class="p-y-3 jumbotron-fluid">
    <div class="container">
      <h3 class="p-b-1 text-xs-center">Related projects</h3>
      <ul class="row list-unstyled flex-items-xs-center">
        <li *ngFor="let project of related" class="col-md-4">
          <div class="panel p-a-1">
            <h4 class="project__title"><a routerLink="/project/{{project.id}}">
              {{project.title}}
            </a></h4>
            <i class="text-muted project__date"> {{ project.created_at | timeAgo}} </i>
            <p>{{project.description | slice:0:40 }}</p>
            <ul class="list-inline text-xs-center" *ngIf="project.position.length > 0">
              <li class="list-inline-item btn btn-sm btn-gradient-primary project__skill-item"
                  *ngFor="let position of project.position">
                {{position.skill.name}}
              </li>
            </ul>
            <br>
            <div class="project__subinfo">
              <img class="profile-img" *ngIf="project.user.picture"
                   src="{{project.user.picture+'?s=20&width=20&height=20'}}"><a
              routerLink="/profile/{{project.user_id}}">
              {{project.user.name}}</a>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </aside>
</div>

<div *ngIf="!myProject" bsModal #applyModal="bs-modal" class="modal grow" tabindex="-1" role="dialog"
     aria-labelledby="Apply for this project"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal__close btn" (click)="applyModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-xs-center">Apply for this project</h4>
      </div>
      <app-application (onApply)="applicationSent($event)" [project]="project"></app-application>
    </div>
  </div>
</div>

<div *ngIf="myProject" bsModal #editModal="bs-modal" class="modal grow" tabindex="-1" role="dialog"
     aria-labelledby="Edit project"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal__close btn" (click)="editModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-xs-center">Edit project</h4>
      </div>
      <app-edit-project (onEdit)="editProject()" [project]="project"></app-edit-project>
    </div>
  </div>
</div>

<div *ngIf="myProject" bsModal #deleteModal="bs-modal" class="modal grow" tabindex="-1" role="dialog"
     aria-labelledby="Delete modal"
     aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal__close btn" (click)="deleteModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-xs-center">Are you sure you want to delete your project?</h4>
      </div>
      <div class="modal-body text-xs-center">
        <button (click)="deleteProject()" class="btn btn-danger">Yes</button>
        <button (click)="deleteModal.hide()" class="btn btn-info">No</button>
      </div>
    </div>
  </div>
</div>
