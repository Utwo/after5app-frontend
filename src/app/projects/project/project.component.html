<div *ngIf="project">
  <div class="jumbotron-fluid">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <h2>{{project.title}}</h2>
          by <a routerLink="/profile/{{project.user_id}}">{{project.user.name}}</a> &sdot;
          <i class="text-muted project__date"> {{ project.created_at | timeAgo}} </i>
        </div>
        <div class="col-md-4 text-right" *ngIf="myProject">
          <button class="btn btn-sm btn-primary"
                  title="edit project"
                  (click)="editModal.show()">
            <svg class="icon">
              <use xlink:href="assets/svg/icons.svg#icon-pencil"></use>
            </svg>
            <span class="hidden-sm-down">Edit</span>
          </button>

          <button class="btn btn-sm btn-danger"
                  title="delete project"
                  (click)="deleteModal.show()">
            <svg class="icon">
              <use xlink:href="assets/svg/icons.svg#icon-bin"></use>
            </svg>
            <span class="hidden-sm-down"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
  <article class="container my-3">
    <div class="row">
      <section class="col-lg-8 col-md-7 panel panel--top--bottom p-2 mb-2">
        <div class="my-1">
          <h3 class="title-border title-border--green pb-1">Project description</h3>
          <p class="project-description">{{project.description}}</p>
        </div>
        <hr>
        <div *ngIf="project.position.length > 0" class="mt-3">
          <h3 class="title-border title-border--green pb-1">I need help with</h3>
          <dl *ngFor="let position of project.position">
            <dt class="btn btn-gradient-primary mb-1">
              <strong *ngIf="position.status">{{position.skill.name}}</strong>
              <span *ngIf="!position.status">{{position.skill.name}}</span>
            </dt>
            <dd class="position-description mb-2" [class.text-muted]="!position.status">{{position.description}}</dd>
          </dl>
        </div>
      </section>

      <section class="col-lg-4 col-md-5">
        <div class="sidebar">
          <div class="p-1">
            <div *ngIf="!myProject && state.isLoggedIn()" class="mb-1">
              <button (click)="applyModal.show()" class="btn btn-primary mr-1">
                <svg class="icon">
                  <use xlink:href="assets/svg/icons.svg#icon-rocket-color"></use>
                </svg>
              </button>
              <span>Help this project!</span>
            </div>
            <hr *ngIf="!myProject && state.isLoggedIn()">
            <button *ngIf="!myProject && state.isLoggedIn()"
                    #favorite
                    (click)="addFavorite()"
                    class="btn mr-1 btn-circle" [class.btn-danger]="isFavorite"
                    [class.btn-primary]="!isFavorite">
              <svg *ngIf="isFavorite" class="icon">
                <use xlink:href="assets/svg/icons.svg#icon-heart"></use>
              </svg>
              <svg *ngIf="!isFavorite" class="icon text-info">
                <use xlink:href="assets/svg/icons.svg#icon-heart-o"></use>
              </svg>
            </button>
            <span #favoriteSpan title="Login to favorite a project">
              <svg *ngIf="!state.isLoggedIn() || myProject"
                   class="icon text-primary icon-lg mr-1">
                <use xlink:href="assets/svg/icons.svg#icon-heart"></use>
              </svg> {{project.favorite_count}} favorites</span>
          </div>
          <div class="sidebar__footer text-center bg-primary-gradient py-1">
            <a
              href="https://www.facebook.com/dialog/share?app_id={{environment.FACEBOOK_ID}}&display=popup&href={{href}}&redirect_uri={{href}}&quote=Check%20out%20this%20project%20and%20help%20it%20become%20a%20reality"
              class="btn btn-primary btn-facebook mr-1" target="_blank">
              <svg class="icon icon-lg">
                <use xlink:href="assets/svg/icons.svg#icon-facebook2"></use>
              </svg>
              Share</a>
            <a
              href="https://twitter.com/share?url={{href}}&hashtags=after5app&text=Check%20out%20this%20project%20and%20help%20it%20become%20a%20reality"
              class="btn btn-info btn-twitter ml-1" target="_blank">
              <svg class="icon icon-lg">
                <use xlink:href="assets/svg/icons.svg#icon-twitter"></use>
              </svg>
              Tweet</a>
          </div>
        </div>

        <div *ngIf="members && members.length > 0">
          <h3 class="title-border title-border--green pb-1 mt-2">Members</h3>
          <ul class="list-unstyled">
            <li *ngFor="let member of members; let i = index" class="panel mb-1">
              <a routerLink="/profile/{{member.id}}">
                <img class="profile-img mr-1"
                     src="{{member.picture+'?s=30&width=30&height=30'}}">
                {{member.name}}
              </a>

              <button class="btn btn-sm btn-outline-danger ml-1"
                      title="remove member"
                      *ngIf="myProject"
                      (click)="removeMember(i)">
                &times;
              </button>
            </li>
          </ul>
        </div>
      </section>
    </div>

  </article>

  <div class="container my-3">
    <div class="row">
      <tabset class="col-lg-8 col-md-7">
        <tab [heading]='Comments' [active]="true">
          <template tabHeading>
            Comments
          </template>
          <app-comments [project_id]="project.id"
                        [comments]="project.comment"
                        class="row comment panel--left">
          </app-comments>
        </tab>

        <tab *ngIf="isMember || myProject" [heading]='Messages'>
          <template tabHeading>
            <span title="only visible to project members">Messages</span>
          </template>
          <app-messages [owner_id]="project.user_id"
                        [project_id]="project.id"
                        class="row comment panel--left">
          </app-messages>
        </tab>

        <tab *ngIf="myProject" [heading]='Applications'>
          <template tabHeading>
            <span>Applications
              <strong *ngIf="applications && pendingApplicationsCount() > 0"
                      class="btn btn-primary btn-sm btn-circle-sm">
                {{pendingApplicationsCount()}}
              </strong>
            </span>
          </template>
          <app-user-applications [questions]="project.application_questions"
                                 [project_id]="project.id"
                                 (onResponse)="applicationResponse($event)">
          </app-user-applications>
        </tab>
      </tabset>
    </div>
  </div>
  <aside *ngIf="related && related.length > 0" class="py-3 jumbotron-fluid">
    <div class="container">
      <h3 class="pb-1 text-center">Related projects</h3>
      <ul class="row list-unstyled flex-items-xs-center">
        <li *ngFor="let project of related" class="col-md-4">
          <div class="panel p-1">
            <h4 class="project__title"><a routerLink="/project/{{project.id}}">
              {{project.title}}
            </a></h4>
            <i class="text-muted project__date"> {{ project.created_at | timeAgo}} </i>
            <p>{{project.description | slice:0:40 }}</p>
            <ul class="list-inline text-center" *ngIf="project.position.length > 0">
              <li class="list-inline-item btn btn-sm btn-gradient-primary project__skill-item"
                  *ngFor="let position of project.position">
                {{position.skill.name}}
              </li>
            </ul>
            <br>
            <div class="project__subinfo">
              <img class="profile-img" *ngIf="project.user.picture"
                   src="{{project.user.picture+'?s=20&width=20&height=20'}}"><a
              routerLink="/profile/{{project.user_id}}">
              {{project.user.name}}</a>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </aside>
</div>

<div *ngIf="!myProject" bsModal #applyModal="bs-modal" class="modal grow"
     tabindex="-1" role="dialog"
     aria-labelledby="Apply for this project"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button"
                class="modal__close btn"
                (click)="applyModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-center">Apply for this project</h4>
      </div>
      <app-application (onApply)="applicationSent($event)" [project]="project"></app-application>
    </div>
  </div>
</div>

<div *ngIf="myProject" bsModal #editModal="bs-modal" class="modal grow"
     tabindex="-1"
     role="dialog"
     aria-labelledby="Edit project"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button"
                class="modal__close btn"
                (click)="editModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-center">Edit project</h4>
      </div>
      <app-edit-project (onEdit)="editProject()" [project]="project"></app-edit-project>
    </div>
  </div>
</div>

<div *ngIf="myProject" bsModal #deleteModal="bs-modal" class="modal grow"
     tabindex="-1"
     role="dialog"
     aria-labelledby="Delete modal"
     aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button"
                class="modal__close btn"
                (click)="deleteModal.hide()"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-center">Are you sure you want to delete your project?</h4>
      </div>
      <div class="modal-body text-center">
        <button (click)="deleteProject()" class="btn btn-danger">Yes</button>
        <button (click)="deleteModal.hide()" class="btn btn-info">No</button>
      </div>
    </div>
  </div>
</div>
